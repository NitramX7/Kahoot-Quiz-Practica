<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>En Juego | QuizMaster Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/css/quizmaster.css?v=2">
    <link rel="stylesheet" href="/css/rooms/game_host.css">
</head>

<body>
    <div class="app-layout">
        <div th:replace="~{fragments/sidebar :: sidebar('')}"></div>

        <main class="main-content" style="max-width: 1200px; margin: 0 auto;">
            <div class="d-flex justify-between align-center mb-4" th:if="${currentQuestion != null}">
                <div class="badge badge-primary">Pregunta <span th:text="${currentQuestion.orderNum}">1</span></div>
                <div style="font-size: 24px; font-weight: 800; color: #2563EB;" id="timerDisplay">
                    <i class="fas fa-clock"></i> <span th:text="${room.timePerQuestion}">20</span>s
                </div>
            </div>

            <div class="timer-bar" th:if="${currentQuestion != null}">
                <div class="timer-fill" id="timerFill"></div>
            </div>

            <div class="question-card" th:if="${currentQuestion != null}">
                <h1 style="font-size: 36px; color: #1E293B; margin-bottom: 30px;"
                    th:text="${currentQuestion.question.text}">
                    ¿Pregunta de ejemplo?
                </h1>

                <div class="monitor-grid">
                    <div class="monitor-stat">
                        <div style="font-size: 40px; font-weight: 800; color: #10B981;" id="answersCount">0</div>
                        <div style="color: #64748B;">Respuestas</div>
                    </div>
                    <div class="monitor-stat">
                        <div style="font-size: 40px; font-weight: 800; color: #6366F1;"
                            th:text="${#lists.size(room.players)}">0</div>
                        <div style="color: #64748B;">Jugadores</div>
                    </div>
                </div>
            </div>

            <div class="question-card" th:if="${currentQuestion == null}">
                <h2 style="font-size: 28px; color: #1E293B; margin-bottom: 10px;">
                    Esperando a que se abra la pregunta...
                </h2>
                <p style="color: #64748B;">En unos segundos debería mostrarse automáticamente.</p>
            </div>
        </main>
    </div>

    <!--Añadir token CSRF para JS-->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    
    <!-- IMPORTANTE: El inline script debe ir ANTES del archivo externo -->
    <!-- NO usar 'var' para que las variables sean globales -->
    <script th:inline="javascript">
        // Pass server-side data to JavaScript (GLOBAL SCOPE)
        roomId = /*[[${room.id}]]*/ null;
        timeLimit = /*[[${room.timePerQuestion}]]*/ 20;
        timeLeft = timeLimit;
        currentQuestionId = /*[[${currentQuestion != null ? currentQuestion.id : null}]]*/ null;
        
        console.log('[HOST] Variables inicializadas:', { roomId, timeLimit, currentQuestionId });
    </script>
    
    <script src="/js/rooms/game_host.js"></script>
</body>

</html>